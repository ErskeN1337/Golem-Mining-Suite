<UserControl x:Class="Golem_Mining_Suite.Views.WalletView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Golem_Mining_Suite.ViewModels"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=vm:WalletViewModel}"
             Background="{DynamicResource SecondaryBackgroundBrush}">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <!-- Fix for White Bar: Style DataGrid Headers -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- History -->
        </Grid.RowDefinitions>

        <!-- Header: Balance and Actions -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBackgroundBrush}" CornerRadius="8" Padding="30" Margin="0,0,0,20">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="2"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Balance Display -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock Text="Current Balance" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="14" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding CurrentBalance, StringFormat={}{0:N0}}" FontSize="48" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text=" aUEC" FontSize="24" Foreground="{DynamicResource AccentBrush}" VerticalAlignment="Bottom" Margin="5,0,0,8"/>
                    </StackPanel>
                </StackPanel>

                <!-- Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Command="{Binding OpenDepositCommand}" Margin="10,0" Padding="20,10" Background="#27AE60" Foreground="White" BorderThickness="0" Cursor="Hand">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="4"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="➕" Margin="0,0,10,0"/>
                            <TextBlock Text="Deposit" FontWeight="Bold"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding OpenWithdrawCommand}" Padding="20,10" Background="#C0392B" Foreground="White" BorderThickness="0" Cursor="Hand">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="4"/>
                            </Style>
                        </Button.Resources>
                         <StackPanel Orientation="Horizontal">
                            <TextBlock Text="➖" Margin="0,0,10,0"/>
                            <TextBlock Text="Withdraw" FontWeight="Bold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Transaction History -->
        <DockPanel Grid.Row="1">
            <TextBlock DockPanel.Dock="Top" Text="Transaction History" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,10"/>
            
            <DataGrid ItemsSource="{Binding Transactions}" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True" 
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#333"
                      Background="Transparent"
                      BorderThickness="0"
                      RowBackground="Transparent"
                      ColumnHeaderHeight="40">
                <DataGrid.Resources>
                    <!-- Make sure the row background is transparent/dark when selected -->
                    <Style TargetType="DataGridCell">
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                    </Style>
                </DataGrid.Resources>
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="140">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100">
                         <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*">
                         <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTemplateColumn Header="Amount" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Amount, StringFormat={}{0:N0}}" HorizontalAlignment="Right" FontWeight="SemiBold" Padding="5" VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="Income">
                                                    <Setter Property="Foreground" Value="#2ECC71"/>
                                                    <Setter Property="Text" Value="{Binding Amount, StringFormat=+{0:N0}}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="Deposit">
                                                    <Setter Property="Foreground" Value="#2ECC71"/>
                                                    <Setter Property="Text" Value="{Binding Amount, StringFormat=+{0:N0}}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="Expense">
                                                    <Setter Property="Foreground" Value="#E74C3C"/>
                                                    <Setter Property="Text" Value="{Binding Amount, StringFormat=-{0:N0}}"/>
                                                </DataTrigger>
                                                 <DataTrigger Binding="{Binding Type}" Value="Withdraw">
                                                    <Setter Property="Foreground" Value="#E74C3C"/>
                                                    <Setter Property="Text" Value="{Binding Amount, StringFormat=-{0:N0}}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                     <DataGridTextColumn Header="Balance" Binding="{Binding BalanceAfter, StringFormat={}{0:N0}}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </DockPanel>

        <!-- Transaction Popup Overlay -->
        <Grid Grid.RowSpan="2" Background="#AA000000" Visibility="{Binding IsTransactionPopupVisible, Converter={StaticResource BoolToVis}}">
            <Border Background="{DynamicResource PrimaryBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Width="360" VerticalAlignment="Center" HorizontalAlignment="Center" CornerRadius="8" Padding="25">
                 <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.5" BlurRadius="20"/>
                 </Border.Effect>
                 <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="{Binding PopupTitle}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,20" HorizontalAlignment="Center"/>

                    <TextBlock Grid.Row="1" Text="Amount (aUEC):" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                    <TextBox Grid.Row="2" Text="{Binding TransactionAmount}" Height="35" VerticalContentAlignment="Center" Background="{DynamicResource SecondaryBackgroundBrush}" Foreground="{DynamicResource TextPrimaryBrush}" BorderBrush="{DynamicResource BorderBrush}" Padding="5" Margin="0,0,0,15"/>

                    <TextBlock Grid.Row="3" Text="Description (Optional):" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                    <TextBox Grid.Row="4" Text="{Binding TransactionDescription}" Height="35" VerticalContentAlignment="Center" Background="{DynamicResource SecondaryBackgroundBrush}" Foreground="{DynamicResource TextPrimaryBrush}" BorderBrush="{DynamicResource BorderBrush}" Padding="5" Margin="0,0,0,25"/>

                    <Grid Grid.Row="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="15"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" Command="{Binding ConfirmTransactionCommand}" Content="Save" Height="40" Background="{DynamicResource AccentBrush}" Foreground="White" BorderThickness="0" Cursor="Hand" FontWeight="SemiBold">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="6"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                        
                        <Button Grid.Column="2" Command="{Binding CancelTransactionCommand}" Content="Cancel" Height="40" Background="Transparent" BorderBrush="{DynamicResource TextSecondaryBrush}" BorderThickness="1" Foreground="{DynamicResource TextSecondaryBrush}" Cursor="Hand" FontWeight="SemiBold">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="6"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </Grid>
                 </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
